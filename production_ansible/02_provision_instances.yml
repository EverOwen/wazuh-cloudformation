---
    - hosts: elasticsearch[0]
      roles:
        - role: "/tmp/wazuh-ansible/roles/elastic-stack/ansible-elasticsearch"
      become: yes
      become_user: root

    - hosts: elasticsearch[1:]
      strategy: free
      roles:
        - role: "/tmp/wazuh-ansible/roles/elastic-stack/ansible-elasticsearch"
      become: yes
      become_user: root

    - hosts: masters
      strategy: free
      roles:
        - role: "/tmp/wazuh-ansible/roles/wazuh/ansible-wazuh-manager"
        - role: "/tmp/wazuh-ansible/roles/wazuh/ansible-filebeat"
      become: yes
      become_user: root

    - hosts: workers
      strategy: free
      roles:
        - role: "/tmp/wazuh-ansible/roles/wazuh/ansible-wazuh-manager"
        - role: "/tmp/wazuh-ansible/roles/wazuh/ansible-filebeat"
      become: yes
      become_user: root

    - hosts: kibana
      strategy: free
      roles:
        - role: "/tmp/wazuh-ansible/roles/elastic-stack/ansible-kibana"
      tasks:
        - name: Allow Kibana to bind to ports less than 1024
          shell: setcap 'CAP_NET_BIND_SERVICE=+eip' /usr/share/kibana/node/bin/node
          notify: restart kibana
      become: yes
      become_user: root
